<header class="site-header">
  <div class="container-feroce py-8">
    <h1 class="site-title text-center text-3xl font-extrabold tracking-tight">
      <a href="{{ site.Home.RelPermalink }}" class="brand-link inline-flex items-center gap-3">
        <img src="{{ "fd_icon.png" | relURL }}" alt="Icone Feroce Dolls" width="36" height="36" loading="eager" decoding="sync" fetchpriority="high" class="brand-icon brand-icon-light h-9 w-9 rounded-md object-cover">
        <img src="{{ "fd_icon_w.png" | relURL }}" alt="" aria-hidden="true" width="36" height="36" loading="eager" decoding="sync" fetchpriority="high" class="brand-icon brand-icon-dark h-9 w-9 rounded-md object-cover">
        <span>{{ site.Title }}</span>
      </a>
    </h1>

    <div class="site-header-controls mt-6">
      {{ with site.Menus.main }}
        <nav class="site-nav" aria-label="Navigation principale">
          {{ $currentSectionKey := partial "page-section-key.html" (dict "page" $) }}
          {{ range . }}
            {{/* Derive the section key from menu page first, then fallback to URL path. */}}
            {{ $sectionKey := "" }}
            {{ with .Page }}
              {{ $sectionKey = partial "page-section-key.html" (dict "page" .) }}
            {{ end }}
            {{ if eq $sectionKey "" }}
              {{ $menuPath := strings.Trim .URL "/" }}
              {{ if eq $menuPath "" }}
                {{ $sectionKey = "home" }}
              {{ else }}
                {{ $sectionKey = index (split $menuPath "/") 0 }}
              {{ end }}
            {{ end }}

            {{/* Hide menu entries when the related section is disabled in config. */}}
            {{ $sectionEnabled := partial "section-enabled.html" (dict "site" site "key" $sectionKey) }}
            {{ if $sectionEnabled }}
              {{/* Keep menu active state independent from baseURL/subpath differences. */}}
              {{ $isActive := false }}
              {{ if eq $sectionKey "home" }}
                {{ $isActive = $.IsHome }}
              {{ else if ne $currentSectionKey "" }}
                {{ $isActive = eq $currentSectionKey $sectionKey }}
              {{ else }}
                {{/* Fallback for uncommon pages where .Section/.File are not available. */}}
                {{ $menuPath := strings.TrimSuffix "/" .URL }}
                {{ $currentPath := strings.TrimSuffix "/" $.RelPermalink }}
                {{ if eq $menuPath "" }}{{ $menuPath = "/" }}{{ end }}
                {{ if eq $currentPath "" }}{{ $currentPath = "/" }}{{ end }}
                {{ if eq $menuPath "/" }}
                  {{ $isActive = eq $currentPath "/" }}
                {{ else }}
                  {{ $isActive = or (eq $currentPath $menuPath) (hasPrefix $currentPath (printf "%s/" $menuPath)) }}
                {{ end }}
              {{ end }}
              <a href="{{ .URL }}" class="link-main {{ if $isActive }}link-main-active{{ end }}">{{ .Name }}</a>
            {{ end }}
          {{ end }}

          {{ partial "theme-toggle-button.html" . }}
        </nav>
      {{ else }}
        {{ partial "theme-toggle-button.html" . }}
      {{ end }}
    </div>
  </div>
</header>
